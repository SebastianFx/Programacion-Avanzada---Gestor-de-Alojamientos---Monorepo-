<form [formGroup]="form" (ngSubmit)="onSubmit()" class="register-form">
  <!-- Mensaje de éxito -->
  <div *ngIf="successMessage" class="alert alert-success">
    <app-icon name="check-circle" [size]="20"></app-icon>
    <span>{{ successMessage }}</span>
  </div>

  <!-- Mensaje de error -->
  <div *ngIf="errorMessage" class="alert alert-error">
    <app-icon name="alert-circle" [size]="20"></app-icon>
    <span>{{ errorMessage }}</span>
  </div>

  <!-- Información personal -->
  <div class="form-section">
    <h3 class="section-title">Información Personal</h3>
    
    <div class="form-row">
      <app-form-field
        label="Nombre"
        [control]="nombreControl"
        type="text"
        placeholder="Tu nombre"
        id="nombre"
        [required]="true"
        [errorMessages]="{
          required: 'El nombre es requerido',
          minlength: 'Mínimo 2 caracteres',
          maxlength: 'Máximo 50 caracteres'
        }">
      </app-form-field>

      <app-form-field
        label="Apellido"
        [control]="apellidoControl"
        type="text"
        placeholder="Tu apellido"
        id="apellido"
        [required]="true"
        [errorMessages]="{
          required: 'El apellido es requerido',
          minlength: 'Mínimo 2 caracteres',
          maxlength: 'Máximo 50 caracteres'
        }">
      </app-form-field>
    </div>

    <!-- Fecha de Nacimiento -->
    <div class="form-field-wrapper">
      <label class="field-label">
        Fecha de Nacimiento
        <span class="required-mark">*</span>
      </label>
      <input
        type="date"
        class="date-input"
        [class.input-error]="fechaNacimientoControl.invalid && (fechaNacimientoControl.dirty || fechaNacimientoControl.touched)"
        [class.input-success]="fechaNacimientoControl.valid && fechaNacimientoControl.touched"
        formControlName="fechaNacimiento"
        [min]="minDate"
        [max]="maxDate"
      />
      <div 
        *ngIf="fechaNacimientoControl.invalid && (fechaNacimientoControl.dirty || fechaNacimientoControl.touched)" 
        class="field-error">
        <app-icon name="alert-circle" [size]="16"></app-icon>
        <span *ngIf="fechaNacimientoControl.errors?.['required']">La fecha de nacimiento es requerida</span>
        <span *ngIf="fechaNacimientoControl.errors?.['edadMinima']">Debes ser mayor de 18 años</span>
      </div>
    </div>
  </div>

  <!-- Información de contacto -->
  <div class="form-section">
    <h3 class="section-title">Información de Contacto</h3>
    
    <app-form-field
      label="Correo Electrónico"
      [control]="emailControl"
      type="email"
      placeholder="tu@email.com"
      id="email"
      [required]="true"
      [errorMessages]="{
        required: 'El correo es requerido',
        email: 'Ingresa un correo válido'
      }">
    </app-form-field>

    <app-form-field
      label="Teléfono"
      [control]="telefonoControl"
      type="tel"
      placeholder="3001234567"
      id="telefono"
      [required]="true"
      [errorMessages]="{
        required: 'El teléfono es requerido',
        pattern: 'Ingresa un teléfono válido de 10 dígitos'
      }">
    </app-form-field>
  </div>

  <!-- Foto de Perfil -->
  <div class="form-section">
    <h3 class="section-title">Foto de Perfil</h3>
    
    <app-image-upload
      label="Imagen de Perfil (Opcional)"
      [required]="false"
      [maxSizeMB]="5"
      formControlName="fotoPerfil">
    </app-image-upload>
    
    <p class="field-hint">
      <app-icon name="info" [size]="14"></app-icon>
      <span>Agrega una foto para personalizar tu perfil</span>
    </p>
  </div>

  <!-- Seguridad -->
  <div class="form-section">
    <h3 class="section-title">Seguridad</h3>
    
    <app-form-field
      label="Contraseña"
      [control]="passwordControl"
      type="password"
      placeholder="••••••••"
      id="password"
      [required]="true"
      [errorMessages]="{
        required: 'La contraseña es requerida',
        minlength: 'Mínimo 6 caracteres',
        maxlength: 'Máximo 50 caracteres'
      }">
    </app-form-field>

    <app-form-field
      label="Confirmar Contraseña"
      [control]="confirmPasswordControl"
      type="password"
      placeholder="••••••••"
      id="confirmPassword"
      [required]="true"
      [errorMessages]="{
        required: 'Confirma tu contraseña'
      }">
    </app-form-field>

    <div *ngIf="showPasswordMismatchError" class="password-mismatch-error">
      <app-icon name="alert-circle" [size]="16"></app-icon>
      <span>Las contraseñas no coinciden</span>
    </div>
  </div>

  <!-- Tipo de usuario -->
  <div class="form-section">
    <h3 class="section-title">Tipo de Usuario</h3>
    
    <div class="user-type-selector">
      <label *ngFor="let tipo of tiposUsuario" class="user-type-option">
        <input
          type="radio"
          [value]="tipo.value"
          formControlName="tipoUsuario"
          [id]="'tipo-' + tipo.value"
        />
        <div class="user-type-card">
          <app-icon 
            [name]="tipo.value === 'USUARIO' ? 'user' : 'home'" 
            [size]="24">
          </app-icon>
          <span class="user-type-label">{{ tipo.label }}</span>
          <span class="user-type-description">
            {{ tipo.value === 'USUARIO' 
              ? 'Busca y reserva alojamientos' 
              : 'Ofrece tus espacios en renta' }}
          </span>
        </div>
      </label>
    </div>
  </div>

  <!-- Botón de envío -->
  <app-button
    type="submit"
    variant="primary"
    size="large"
    [fullWidth]="true"
    [loading]="loading"
    [disabled]="form.invalid || loading">
    {{ loading ? 'Registrando...' : 'Crear Cuenta' }}
  </app-button>
</form>
